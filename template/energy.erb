#! /usr/bin/env Rscript

<% colors = ["#E04836", "#5696BC", "#F39D41", "#8D5924", "#2F5168", "#BEE6B1", "#D3B1DE"] %>

data <- read.table("<%= @source %>", header=T, sep=",")
attach(data)

# Compute the range of the series 
<% @nodes = @nodes.map {|val| val.gsub(/\-/, '.') } %>
g_range <- range(0<% for host in @nodes %>,<%= host %> <% end %>)

<% pch_start = 20 %>
<% lty_start = 3 %>

<% cex = 1 %>
<% lwd = 1 %>
<% legend_cex = 2 %>
<% legend_lwd = 1 %>

<% title_enabled = true %>

# Plot the serie
<% count = 0 %>
<% for host in @nodes  %>
	<% if count == 0 %>
		plot(<%= host %>, type="l", col="<%= colors[count] %>", ylim=g_range,
		lwd=<%= lwd %>, lty=1, axes=FALSE, ann=FALSE)
	<% else %>
		lines(<%= host %>, col="<%= colors[count] %>")
	<% end %>
	<% count+= 1 %>
<% end %>


# Generate x-axis
axis(1)

# Generate x-axis
axis(2)

# Create box around plot
box()

<% if title_enabled %>
# 		Create a title with a red, bold/italic font
title(main="<%= @title %>", font.main=4)
<% end %>

# 		Label the x and y axes with dark green text
title(xlab="<%= @x_label %>", col.lab=rgb(0,0,0))
title(ylab="<%= @y_label %>", col.lab=rgb(0,0,0))

#abline(h=3600,col="black",lty=2)
# text(1.5, (3600+g_range[2]/40), "3600 s", col = "black")

# 		Create a legend at (1, g_range[2]) that is slightly smaller 
# 		(cex) and uses the same line colors and points used by 
# 		the actual plots 
<% count = 0 %>
legend(50, y=60, c(<% for host in @nodes  %><% if count > 0 %>,<% end %>"<%= host %>"<% count += 1 %><% end %>),
	lwd=<%= legend_lwd %>,
	col=c(<% count = 0 %><% for host in @nodes %><% if count > 0 %>,<% end %>"<%= colors[count] %>"<% count += 1 %><% end %>), lty=1, cex=0.8)

<% count = 0 %>
<% for host in @nodes %>
		plot("<%= host %>", type="l", col="<%= colors[count] %>", ylim=g_range,
		lwd=<%= lwd %>, lty=<%= lty_start+count %>, axes=FALSE, ann=FALSE)
		<% count+=1 %>
<% end %>

